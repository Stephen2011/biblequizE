<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Holy Bible Reader & Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="theme-color" content="#8b7500" />

<!-- Add touch-friendly meta tags -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
body{font-family:system-ui;background:#f2f2f2;margin:0; -webkit-text-size-adjust: 100%;}
body.dark{background:#121212;color:#eee}
header{background:darkgoldenrod;color:#fff;padding:14px;text-align:center}
section{padding:10px;text-align:center}
#reader,#quizBox{background:#fff;max-width:720px;margin:10px auto;padding:12px;border-radius:8px; -webkit-overflow-scrolling: touch;}
.qOptions{display:flex;flex-wrap:wrap;justify-content:center;gap:10px}
.qOption{background:#f7f7f7;padding:8px 14px;border-radius:6px;cursor:pointer}
.qOption input{margin-right:6px}
.correct{background:#c8f7c5;border:2px solid #2ecc71}
.wrong{background:#f7c5c5;border:2px solid #e74c3c}
footer{background:#222;color:#ccc;padding:10px;text-align:center}
#dailyVerse{color:gold}
#timer{font-weight:bold;color:#b00}

/* Enhanced CSS for better touch support */
button, label, .qOption {
  cursor: pointer;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
  -webkit-user-select: none;
  min-height: 44px; /* Minimum touch target size */
  min-width: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 20px;
  margin: 4px;
}

/* Ensure buttons have proper spacing on mobile */
button {
  margin: 8px 4px;
  font-size: 16px; /* Prevent iOS zoom on focus */
}

select, input {
  font-size: 16px; /* Prevent iOS zoom on focus */
  touch-action: manipulation;
  min-height: 44px;
  padding: 10px;
}

.qOption {
  flex: 1 0 calc(50% - 20px);
  max-width: calc(50% - 20px);
  text-align: left;
}

/* Remove 300ms delay on click */
html {
  touch-action: manipulation;
}
</style>
</head>

<body>

<header>
  <h3 id="title">üìñ Holy Bible Reader & Quiz</h3>
  <select id="langSelect" class="form-select">
    <option value="en">English</option>
    <option value="fr">Fran√ßais</option>
    <option value="yo">Yor√πb√°</option>
  </select>
</header>

<section>
  <input id="book" placeholder="Book (e.g. Genesis)" />
  <input id="chapter" type="number" placeholder="Chapter" />
  <button id="searchBtn" class="touch-btn">Read</button>

  <div id="reader">Search a Bible chapter‚Ä¶</div>

  <select id="voiceSelect" class="form-select">
    <option>Loading voices‚Ä¶</option>
  </select>

  <button id="ttsBtn" class="touch-btn">üîä Read Aloud</button>
  <button id="stopBtn" class="touch-btn">‚èπ Stop</button>
  <button id="musicBtn" class="touch-btn">üéµ Worship</button>
  <button id="nightBtn" class="touch-btn">üåô Night</button>
</section>

<section id="quizBox">
  <div id="qText" class="fw-bold mb-2"></div>
  <div id="timer"></div>
  <div id="qOptions" class="qOptions"></div>
  <button id="qNext" class="touch-btn">‚ñ∂ Start Quiz</button>
  <button id="restartBtn" class="touch-btn" style="display:none">üîÅ Restart</button>
  <div id="qScore" class="mt-2 fw-bold"></div>
</section>

<footer>
  <div id="dailyVerse"></div>
  <small>¬© 2026 Evangelist Engr. Stephen Jolayemi</small>
</footer>

<script>
// ===== HELPERS =====
const $ = id => document.getElementById(id);

// Enhanced touch/click handler
function bindTouchClick(id, fn) { 
  const el = $(id);
  if (!el) return;
  
  // Remove any existing event listeners to prevent duplicates
  el.removeEventListener('click', fn);
  el.removeEventListener('touchstart', fn);
  
  // Add both touch and click events for maximum compatibility
  el.addEventListener('click', fn, { passive: true });
  el.addEventListener('touchstart', function(e) {
    e.preventDefault();
    fn(e);
  }, { passive: false });
}

// ===== AUDIO =====
const correctSound = new Audio("correct.mp3");
const wrongSound = new Audio("wrong.mp3");
const music = new Audio("worship.mp3"); 
music.loop = true;

// ===== LANGUAGE =====
const LANG = {
 en: {title: "üìñ Holy Bible Reader & Quiz", read: "Read", next: "Next", restart: "Restart", timer: "‚è± Click Start"},
 fr: {title: "üìñ Lecteur Biblique & Quiz", read: "Lire", next: "Suivant", restart: "Red√©marrer", timer: "‚è± Cliquez"},
 yo: {title: "üìñ √åk√†ns√≠ B√≠b√©l√¨ & √åd√°nw√≤", read: "Ka", next: "Itele", restart: "Tun b·∫πÃÄr·∫πÃÄ", timer: "‚è± T·∫π"}
};
let currentLang = localStorage.lang || "en";

function applyLang() {
 const L = LANG[currentLang];
 $("title").innerText = L.title;
 $("searchBtn").innerText = L.read;
 $("qNext").innerText = $("qNext").innerText.includes("‚ñ∂") ? "‚ñ∂ " + L.next : L.next;
 $("restartBtn").innerText = "üîÅ " + L.restart;
 if (!started) $("timer").innerText = L.timer;
}

$("langSelect").value = currentLang;
$("langSelect").onchange = () => {
  currentLang = $("langSelect").value;
  localStorage.lang = currentLang;
  applyLang();
};

// ===== VOICES =====
let voices = [];
speechSynthesis.onvoiceschanged = () => {
 voices = speechSynthesis.getVoices();
 $("voiceSelect").innerHTML = "";
 voices.forEach((v, i) => {
  const o = document.createElement("option");
  o.value = i;
  o.textContent = `${v.name} (${v.lang})`;
  $("voiceSelect").appendChild(o);
 });
};

// ===== DAILY VERSE =====
const verses = [
 "Psalm 23:1 ‚Äì The Lord is my shepherd",
 "John 3:16 ‚Äì For God so loved the world",
 "Philippians 4:13 ‚Äì I can do all things",
 "Joshua 1:9 ‚Äì Be strong and courageous"
];
const key = "verse-" + new Date().toDateString();
if (!localStorage[key]) localStorage[key] = verses[Math.floor(Math.random() * verses.length)];
$("dailyVerse").innerText = localStorage[key];

// ===== QUIZ =====
let quiz = [
 {q: "Who built the ark?", o: ["Noah", "Moses", "David"], a: "Noah"},
 {q: "Who led Israel out of Egypt?", o: ["Moses", "Joshua", "Aaron"], a: "Moses"},
 {q: "Who walked on water?", o: ["Jesus", "Peter", "Moses"], a: "Jesus"},
 {q: "Strongest man?", o: ["Samson", "David", "Saul"], a: "Samson"},
 {q: "First king of Israel?", o: ["Saul", "David", "Solomon"], a: "Saul"}
].sort(() => Math.random() - 0.5);

let qi = 0, score = 0, started = false, timer = null, timeLeft = 15;

function startTimer() {
 clearInterval(timer);
 timeLeft = 15;
 $("timer").innerText = `‚è± ${timeLeft}s`;
 timer = setInterval(() => {
  timeLeft--;
  $("timer").innerText = `‚è± ${timeLeft}s`;
  if (timeLeft <= 0) {
   clearInterval(timer);
   wrongSound.play();
   $("qScore").innerText = `‚ùå Time up! ${quiz[qi].a}`;
   setTimeout(nextQ, 1500);
  }
 }, 1000);
}

function renderQuiz() {
 if (qi >= quiz.length) {
  $("qText").innerText = "üéâ Quiz Finished!";
  $("qOptions").innerHTML = "";
  $("timer").innerText = "";
  $("qScore").innerText = `Score: ${score}/${quiz.length}`;
  $("restartBtn").style.display = "inline-block";
  return;
 }
 $("qText").innerText = quiz[qi].q;
 $("qOptions").innerHTML = quiz[qi].o.map(o => `
 <label class="qOption">
  <input type="radio" name="q" value="${o}"> ${o}
 </label>`).join("");
 $("qScore").innerText = "";
 $("timer").innerText = LANG[currentLang].timer;
 
 // Add touch events to quiz options
 document.querySelectorAll('.qOption').forEach(label => {
   const input = label.querySelector('input');
   label.addEventListener('click', function(e) {
     if (input) {
       input.checked = true;
       // Trigger change event for the radio button
       input.dispatchEvent(new Event('change', { bubbles: true }));
     }
   });
   label.addEventListener('touchstart', function(e) {
     e.preventDefault();
     if (input) {
       input.checked = true;
       input.dispatchEvent(new Event('change', { bubbles: true }));
     }
   }, { passive: false });
 });
}

function nextQ() {
  qi++;
  started = false;
  renderQuiz();
}

// Use enhanced touch/click handlers
bindTouchClick("qNext", () => {
 if (!started) {
   started = true;
   startTimer();
   $("qNext").innerText = LANG[currentLang].next;
   return;
 }
 const sel = document.querySelector('input[name="q"]:checked');
 if (!sel) return;
 clearInterval(timer);
 document.querySelectorAll(".qOption").forEach(l => {
  const v = l.querySelector("input").value;
  if (v === quiz[qi].a) l.classList.add("correct");
  if (l.querySelector("input").checked && v !== quiz[qi].a) l.classList.add("wrong");
 });
 if (sel.value === quiz[qi].a) {
   score++;
   correctSound.play();
   $("qScore").innerText = "‚úÖ Correct!";
 } else {
   wrongSound.play();
   $("qScore").innerText = `‚ùå Correct: ${quiz[qi].a}`;
 }
 setTimeout(nextQ, 1500);
});

bindTouchClick("restartBtn", () => {
  qi = 0;
  score = 0;
  quiz.sort(() => Math.random() - 0.5);
  $("restartBtn").style.display = "none";
  renderQuiz();
});

bindTouchClick("searchBtn", () => {
  fetch(`https://bible-api.com/${$("book").value} ${$("chapter").value || 1}`)
    .then(r => r.json())
    .then(d => $("reader").innerText = d.text || "‚ùå Not found")
    .catch(() => $("reader").innerText = "‚ùå Error fetching");
});

bindTouchClick("ttsBtn", () => {
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance($("reader").innerText);
  const v = voices[$("voiceSelect").value];
  if (v) u.voice = v;
  speechSynthesis.speak(u);
});

bindTouchClick("stopBtn", () => speechSynthesis.cancel());
bindTouchClick("musicBtn", () => music.paused ? music.play() : music.pause());
bindTouchClick("nightBtn", () => document.body.classList.toggle("dark"));

// Initialize
applyLang();
renderQuiz();

// Add touchstart listener to body to ensure touch events work
document.body.addEventListener('touchstart', function() {}, {passive: true});

// Prevent context menu on long press for buttons
document.addEventListener('contextmenu', function(e) {
  if (e.target.tagName === 'BUTTON' || e.target.tagName === 'LABEL') {
    e.preventDefault();
  }
});

// Force initial voice load
if (speechSynthesis.getVoices().length > 0) {
  speechSynthesis.onvoiceschanged();
}
</script>

</body>
</html>